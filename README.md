# WinGenTurner

目線や口の動きを検知して、楽譜PDFを表示しているAcrobat Readerのページめくり（上下キー押下）を行うWindowsアプリケーションです。

## 機能

1. **タスクトレイアイコン**: 起動するとタスクトレイにアイコンを表示し、右クリックメニューから終了できます
2. **ステータスウィンドウ**: 起動と同時に検知状況を表すステータスウィンドウを最前面かつアクティブではないウィンドウとして表示します
3. **モニターウィンドウ**: ステータスウィンドウをクリックすると、カメラ映像を表示するモニターウィンドウの表示/非表示を切り替えます
4. **目線検知**: 目線が上を向いていることを検知すると、アクティブウィンドウに対して上キー入力を送出します
5. **口開検知**: 口を開くと、アクティブウィンドウに対して下キー入力を送出します

## 必要環境

- Windows 10/11
- .NET 10.0 Runtime
- Webカメラ
- インターネット接続（初回起動時のみ、顔検出用データファイルのダウンロードに必要）

## 使用方法

1. アプリケーションを起動します
2. 初回起動時、顔検出に必要なHaar Cascadeファイルが自動的にダウンロードされます
3. ステータスウィンドウが画面左上に表示されます
4. カメラ映像を確認したい場合は、ステータスウィンドウをクリックしてモニターウィンドウを表示します
5. Adobe Acrobat Readerで楽譜PDFを開き、そのウィンドウをアクティブにします
6. カメラに向かって以下の動作を行うと、ページがめくられます：
   - **上を向く** → 前のページへ（上キー）
   - **口を開ける** → 次のページへ（下キー）

## 注意事項

- キー入力には1秒のクールダウン時間があります（連続入力を防ぐため）
- カメラの映像は約30fpsで処理されます
- 顔検出の精度は照明条件やカメラの位置によって変わります
- 最良の結果を得るには、カメラを正面に配置し、適切な照明を確保してください

## トラブルシューティング

### カメラが起動しない
- 他のアプリケーションがカメラを使用していないか確認してください
- デバイスマネージャーでカメラが正しく認識されているか確認してください

### 顔検出が動作しない
- 初回起動時にインターネット接続が必要です
- アプリケーションフォルダに以下のファイルが存在するか確認してください：
  - haarcascade_frontalface_default.xml
  - haarcascade_eye.xml
  - haarcascade_smile.xml

### キー入力が送信されない
- 対象のアプリケーション（Acrobat Readerなど）がアクティブウィンドウになっているか確認してください
- アプリケーションを管理者として実行してみてください

## 技術仕様

- **開発言語**: C# 14.0
- **フレームワーク**: .NET 10.0 / WPF
- **画像処理**: OpenCvSharp4
- **顔検出**: Haar Cascade分類器
- **UI**: WPF (Windows Presentation Foundation)

## ライセンス

このプロジェクトで使用している主なライブラリ：
- OpenCvSharp4 (Apache License 2.0)
- Hardcodet.NotifyIcon.Wpf (Code Project Open License)
- OpenCV Haar Cascades (BSD License)

## 開発情報

### プロジェクト構造

```
WinGenTurner/
├── App.xaml / App.xaml.cs          # アプリケーションエントリーポイント
├── StatusWindow.xaml / .cs         # ステータス表示ウィンドウ
├── MonitorWindow.xaml / .cs        # カメラ映像表示ウィンドウ
├── Services/
│   ├── CameraService.cs            # カメラキャプチャ処理
│   ├── FaceDetectionService.cs     # 顔・目・口の検出処理
│   ├── KeyInputService.cs          # キーボード入力送信
│   └── CascadeHelper.cs            # Haar Cascadeファイル管理
└── Resources/
    └── app.ico                     # アプリケーションアイコン
```

### ビルド方法

```bash
dotnet restore
dotnet build
```

または Visual Studio 2022以降でソリューションを開いてビルドしてください。
